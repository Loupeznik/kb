# Docusaurus Implementation Guide

This document outlines the steps to convert the knowledge base to a Docusaurus site hosted on GitHub Pages.

## Prerequisites

- Node.js 22.0 or higher (preferably 24.0+)
- npm or yarn package manager
- Git repository with existing markdown files

## Initial Setup

### 1. Initialize Docusaurus

```bash
npx create-docusaurus@latest website classic --typescript
```

This creates a `website` directory with the Docusaurus scaffolding.

### 2. Configure for GitHub Pages

Edit `website/docusaurus.config.ts`:

```typescript
const config: Config = {
  title: 'Knowledge Base',
  tagline: 'Personal knowledgebase - Development, Ops, Cloud, DevOps, Databases, Pentesting',
  favicon: 'img/favicon.ico',

  url: 'https://<username>.github.io',
  baseUrl: '/kb/',

  organizationName: '<username>',
  projectName: 'kb',
  deploymentBranch: 'gh-pages',
  trailingSlash: false,

  onBrokenLinks: 'warn',
  onBrokenMarkdownLinks: 'warn',

  i18n: {
    defaultLocale: 'en',
    locales: ['en'],
  },

  presets: [
    [
      'classic',
      {
        docs: {
          routeBasePath: '/',
          sidebarPath: './sidebars.ts',
          editUrl: 'https://github.com/<username>/kb/tree/master/',
        },
        blog: false,
        theme: {
          customCss: './src/css/custom.css',
        },
      } satisfies Preset.Options,
    ],
  ],

  themeConfig: {
    navbar: {
      title: 'Knowledge Base',
      items: [
        {
          href: 'https://github.com/<username>/kb',
          label: 'GitHub',
          position: 'right',
        },
      ],
    },
    footer: {
      style: 'dark',
      copyright: `Personal Knowledge Base © ${new Date().getFullYear()}`,
    },
    prism: {
      theme: prismThemes.github,
      darkTheme: prismThemes.dracula,
      additionalLanguages: ['bash', 'powershell', 'yaml', 'json', 'csharp', 'sql'],
    },
  } satisfies Preset.ThemeConfig,
};
```

Replace `<username>` with your GitHub username.

### 3. Migrate Existing Documentation

Move existing markdown files to the Docusaurus structure:

```bash
# From repository root
cd website

# Remove default docs
rm -rf docs/*

# Copy existing docs
cp -r ../Cloud docs/
cp -r ../DB docs/
cp -r ../DevOps docs/
cp -r ../Docker docs/
cp -r ../DotNet docs/
cp -r ../Git docs/
cp -r ../Infra docs/
cp -r ../k8s docs/
cp -r ../Pentesting docs/
cp -r ../Powershell docs/
```

### 4. Configure Sidebar

Edit `website/sidebars.ts` for auto-generated sidebar:

```typescript
import type {SidebarsConfig} from '@docusaurus/plugin-content-docs';

const sidebars: SidebarsConfig = {
  knowledgeBaseSidebar: [
    {
      type: 'autogenerated',
      dirName: '.',
    },
  ],
};

export default sidebars;
```

### 5. Add Category Metadata

Create `_category_.json` files in each top-level directory to control sidebar display:

```bash
# Example for Cloud directory
cat > docs/Cloud/_category_.json << EOF
{
  "label": "Cloud Platforms",
  "position": 1,
  "collapsed": false
}
EOF

# Example for Infra directory
cat > docs/Infra/_category_.json << EOF
{
  "label": "Infrastructure",
  "position": 2,
  "collapsed": false
}
EOF
```

Repeat for all top-level categories with appropriate labels and positions.

### 6. Add Front Matter to Markdown Files

Add metadata to existing markdown files for better organization:

```markdown
---
title: SELinux Configuration
sidebar_position: 1
---

# SELinux Configuration
[... rest of content ...]
```

This can be done manually or with a script.

## GitHub Actions Deployment

### 1. Create Deployment Workflow

Create `.github/workflows/deploy-docs.yml`:

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches:
      - master
    paths:
      - 'website/**'
      - '.github/workflows/deploy-docs.yml'
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: website
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 24
          cache: npm
          cache-dependency-path: website/package-lock.json

      - name: Install dependencies
        run: npm ci

      - name: Build website
        run: npm run build

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: website/build

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

### 2. Configure GitHub Repository Settings

1. Go to repository Settings → Pages
2. Set Source to "GitHub Actions"
3. Save settings

### 3. Update .gitignore

Add to `.gitignore`:

```
# Docusaurus
website/node_modules
website/build
website/.docusaurus
website/.cache-loader
```

## Local Development

### Build and Test Locally

```bash
cd website

# Install dependencies
npm install

# Start development server
npm start

# Build for production
npm run build

# Serve production build locally
npm run serve
```

The site will be available at `http://localhost:3000`.

## Directory Structure After Implementation

```
kb/
├── website/
│   ├── docs/
│   │   ├── Cloud/
│   │   ├── DB/
│   │   ├── DevOps/
│   │   ├── Docker/
│   │   ├── DotNet/
│   │   ├── Git/
│   │   ├── Infra/
│   │   ├── k8s/
│   │   ├── Pentesting/
│   │   └── Powershell/
│   ├── src/
│   ├── static/
│   ├── docusaurus.config.ts
│   ├── sidebars.ts
│   └── package.json
├── .github/
│   └── workflows/
│       └── deploy-docs.yml
└── [existing files remain in root]
```

## Post-Implementation Tasks

1. Test all internal links between documents
2. Verify code syntax highlighting works correctly
3. Customize theme colors in `website/src/css/custom.css`
4. Add home page content in `website/src/pages/index.tsx`
5. Test mobile responsiveness
6. Verify all images load correctly

## Maintenance

### Adding New Documentation

1. Create markdown file in appropriate `website/docs/` subdirectory
2. Add front matter with title and position
3. Commit and push to master
4. GitHub Actions will automatically deploy

### Updating Existing Documentation

Simply edit files in `website/docs/` and commit changes. Deployment is automatic on push to master.

## Troubleshooting

### Build Fails on GitHub Actions

- Check Node.js version compatibility
- Verify all markdown files have valid syntax
- Check for broken internal links

### Local Development Server Won't Start

- Clear cache: `npm run clear`
- Delete `node_modules` and reinstall: `rm -rf node_modules && npm install`
- Check Node.js version: `node --version` (should be 22+, preferably 24+)

### Images Not Loading

- Ensure images are in `website/static/` directory
- Reference images with `/img/filename.png` in markdown
- Or keep images next to markdown files and reference with `./image.png`
